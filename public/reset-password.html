<!doctype html>
<html lang="uz" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parolni tiklash — HALLAYM edu</title>
  <meta name="description" content="Reset token va yangi parol orqali parolni yangilash." />

  <script>
    tailwind = {
      config: {
        darkMode: 'class',
        theme: { extend: { fontFamily: { inter: ['Inter','ui-sans-serif','system-ui'] } } }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    :root{
      --glass-bg: rgba(255,255,255,.62);
      --glass-brd: rgba(255,255,255,.34);
      --muted: rgba(15,23,42,.74);
      --muted2: rgba(15,23,42,.56);
      --ring: rgba(20,184,166,.42);
      --grid: rgba(2,132,199,.08);
      --gold: rgba(245,158,11,1);
      --teal: rgba(20,184,166,1);
      --deep: rgba(2,6,23,1);
      --ok: rgba(16,185,129,.18);
      --bad: rgba(239,68,68,.18);
    }
    .dark{
      --glass-bg: rgba(2,6,23,.62);
      --glass-brd: rgba(148,163,184,.14);
      --muted: rgba(226,232,240,.82);
      --muted2: rgba(226,232,240,.58);
      --ring: rgba(245,158,11,.22);
      --grid: rgba(148,163,184,.08);
      --gold: rgba(245,158,11,1);
      --teal: rgba(20,184,166,1);
      --deep: rgba(2,6,23,1);
      --ok: rgba(16,185,129,.14);
      --bad: rgba(239,68,68,.14);
    }
    body{ font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .muted{ color: var(--muted); }
    .muted2{ color: var(--muted2); }
    .glass{
      background: var(--glass-bg);
      border: 1px solid var(--glass-brd);
      box-shadow: 0 20px 60px rgba(0,0,0,.18);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
    .btn-primary{ background: linear-gradient(135deg, rgba(20,184,166,1), rgba(250,204,21,1), rgba(245,158,11,1)); }
    .btn-primary:hover{ filter: brightness(1.05); }
.btn-primary{
      border: 1px solid rgba(245,158,11,.22);
      box-shadow: 0 18px 46px rgba(2,6,23,.18);
    }
    .dark .btn-primary{ box-shadow: 0 18px 46px rgba(0,0,0,.35); }

    @media (max-width: 420px){
      h1,h2{ letter-spacing: -0.02em; }
      .glass{ backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
    }
    .btn-ghost:hover{ background: rgba(148,163,184,.12); }
    .glow-ring:focus{ outline:none; box-shadow: 0 0 0 5px var(--ring); }

    .bg-orbs{
      position: fixed; inset: 0; z-index: -2; overflow: hidden;
      background:
        radial-gradient(1200px 700px at 12% 14%, rgba(20,184,166,.32), transparent 62%),
        radial-gradient(900px 560px at 86% 18%, rgba(245,158,11,.20), transparent 60%),
        radial-gradient(1000px 720px at 50% 92%, rgba(34,211,238,.18), transparent 62%),
        linear-gradient(180deg, rgba(241,250,249,1), rgba(226,248,246,1));
    }
    .dark .bg-orbs{
      background:
        radial-gradient(1200px 700px at 12% 14%, rgba(20,184,166,.18), transparent 62%),
        radial-gradient(900px 560px at 86% 18%, rgba(245,158,11,.12), transparent 60%),
        radial-gradient(1000px 720px at 50% 92%, rgba(34,211,238,.10), transparent 62%),
        linear-gradient(180deg, rgba(2,6,23,1), rgba(3,28,33,1));
    }
    .bg-grid{
      position: fixed; inset: 0; z-index: -1; pointer-events: none;
      background-image: linear-gradient(to right, var(--grid) 1px, transparent 1px),
                        linear-gradient(to bottom, var(--grid) 1px, transparent 1px);
      background-size: 70px 70px;
      mask-image: radial-gradient(closest-side at 50% 35%, black 0%, transparent 70%);
      opacity: .85;
    }
    .u-anim{
      background: linear-gradient(90deg, rgba(20,184,166,1), rgba(250,204,21,1), rgba(245,158,11,1));
      background-size: 200% 200%;
      -webkit-background-clip:text; background-clip:text; color:transparent;
      animation: shimmer 6s ease-in-out infinite;
    }

    .field{
      background: rgba(255,255,255,.38);
      border: 1px solid rgba(255,255,255,.28);
    }
    .dark .field{
      background: rgba(2,6,23,.35);
      border: 1px solid rgba(148,163,184,.18);
    }
    .field:focus{
      outline: none;
      box-shadow: 0 0 0 5px var(--ring);
      border-color: transparent;
    }

    .g-border{ position: relative; }
    .g-border:before{
      content:"";
      position:absolute; inset:-1px; border-radius: 1.5rem;
      background: linear-gradient(135deg, rgba(20,184,166,.42), rgba(250,204,21,.34), rgba(245,158,11,.28));
      z-index:-1;
    }
    .panel-pop{ animation: pop .45s ease-out both; }

    .dark .robot-head{ fill: rgba(2,6,23,.55); }
    .dark .robot-visor{ fill: rgba(226,232,240,.08); }
    .dark .eye-fill{ fill: rgba(226,232,240,.80); }
  
    /* MOBILE_COMPACT_V1 */
    /* Thin, pretty scrollbars (mobile/desktop) */
    *{ scrollbar-width: thin; scrollbar-color: rgba(245,158,11,.45) rgba(148,163,184,.12); }
    *::-webkit-scrollbar{ height: 8px; width: 8px; }
    *::-webkit-scrollbar-track{ background: rgba(148,163,184,.12); border-radius: 999px; }
    *::-webkit-scrollbar-thumb{
      background: linear-gradient(180deg, rgba(20,184,166,.55), rgba(245,158,11,.55));
      border-radius: 999px;
      border: 2px solid rgba(148,163,184,.12);
    }

    /* Helpers */
    .scroll-x{ overflow-x:auto; -webkit-overflow-scrolling:touch; }
    .scroll-y{ overflow-y:auto; -webkit-overflow-scrolling:touch; }
    .no-tap-highlight{ -webkit-tap-highlight-color: transparent; }

    /* Ultra-compact mobile layout */
    @media (max-width: 520px){
      body{ font-size: 13px; }
      .muted{ letter-spacing: 0; }

      header .mx-auto{ padding-left: 12px !important; padding-right: 12px !important; padding-top: 10px !important; padding-bottom: 10px !important; }
      header .glass{
        border-radius: 18px !important;
        padding: 10px 10px !important;
        backdrop-filter: blur(16px) !important;
        -webkit-backdrop-filter: blur(16px) !important;
      }

      /* Logo block */
      header a.flex.items-center.gap-3{ gap: 10px !important; }
      header a .leading-tight .text-xs{ font-size: 10px !important; line-height: 1.2 !important; }
      header a .leading-tight .font-extrabold{ font-size: 14px !important; line-height: 1.15 !important; }
      header a .w-10.h-10{ width: 38px !important; height: 38px !important; border-radius: 16px !important; }
      header a svg{ width: 32px !important; height: 32px !important; }

      /* Header actions */
      #mobileMenuBtn,
      #themeToggle,
      a[href="/login.html"],
      a[href="/register.html"]{
        padding: 8px 10px !important;
        font-size: 12px !important;
        border-radius: 14px !important;
      }
      #themeLabel{ display:none !important; }
      a[href="/login.html"] span{ display:none !important; } /* icon only on tight screens */
      a[href="/register.html"]{ padding: 8px 12px !important; }
      .magnet{ transform:none !important; }

      /* Headings/panels tighter */
      h1{ font-size: 28px !important; line-height: 1.1 !important; }
      h2{ font-size: 22px !important; line-height: 1.15 !important; }
      p{ font-size: 13px !important; }

      .glass.rounded-3xl{ border-radius: 18px !important; }
      .rounded-2xl{ border-radius: 16px !important; }
      .rounded-xl{ border-radius: 14px !important; }

      /* Sections padding */
      section.mx-auto, main.mx-auto{ padding-left: 12px !important; padding-right: 12px !important; }
      .p-8{ padding: 18px !important; }
      .p-7{ padding: 18px !important; }
      .p-6{ padding: 16px !important; }
      .p-5{ padding: 14px !important; }
      .p-4{ padding: 12px !important; }

      /* Prevent text/buttons from forcing overflow */
      button, a, input, select, textarea{ max-width: 100%; }
      .safe-wrap{ overflow-wrap:anywhere; word-break:break-word; }

      /* Mobile drawer: make it scrollable */
      #mobileMenu .glass{ height: 100%; overflow-y: auto; padding-bottom: calc(18px + env(safe-area-inset-bottom)); }
    }

    @media (max-width: 380px){
      h1{ font-size: 26px !important; }
      #mobileMenuBtn,
      #themeToggle,
      a[href="/login.html"],
      a[href="/register.html"]{ padding: 7px 9px !important; font-size: 11px !important; }
    }
    
  
  </style>

  <script>
    (function(){
      const key='theme';
      const saved=localStorage.getItem(key);
      const prefersDark=window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const mode=saved || (prefersDark?'dark':'light');
      if(mode==='dark') document.documentElement.classList.add('dark');
    })();
  </script>
</head>

<body class="min-h-screen text-slate-900 dark:text-slate-100">
  <div class="bg-orbs"></div>
  <div class="bg-grid"></div>

  <header class="sticky top-0 z-50">
    <div class="mx-auto max-w-6xl px-4 py-4">
      <div class="glass rounded-3xl px-4 py-3 flex items-center justify-between">
        <a href="/index.html" class="flex items-center gap-3">
          <div class="w-10 h-10 sm:w-11 sm:h-11 rounded-2xl flex items-center justify-center shadow-glass overflow-hidden"
            style="background: radial-gradient(120% 120% at 20% 20%, rgba(20,184,166,.35), rgba(2,6,23,.0) 60%), radial-gradient(140% 140% at 80% 80%, rgba(245,158,11,.22), rgba(2,6,23,.0) 60%), rgba(2,6,23,.12);">
            <svg viewBox="0 0 120 120" class="w-[34px] h-[34px] sm:w-[38px] sm:h-[38px]" aria-hidden="true">
              <defs>
                <linearGradient id="gGold2" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="rgba(245,158,11,1)"/>
                  <stop offset="0.5" stop-color="rgba(250,204,21,1)"/>
                  <stop offset="1" stop-color="rgba(245,158,11,1)"/>
                </linearGradient>
                <linearGradient id="gIce2" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="rgba(125,211,252,1)"/>
                  <stop offset="0.45" stop-color="rgba(34,211,238,1)"/>
                  <stop offset="1" stop-color="rgba(167,243,208,1)"/>
                </linearGradient>
              </defs>
              <circle cx="60" cy="60" r="54" fill="none" stroke="url(#gGold2)" stroke-width="6" opacity="0.92"/>
              <ellipse cx="60" cy="64" rx="42" ry="24" fill="rgba(2,6,23,.88)" stroke="url(#gGold2)" stroke-width="4"/>
              <path d="M20 44 L26 44 L28 38 L30 44 L36 44 L31 47 L33 53 L28 49 L23 53 L25 47 Z"
                    fill="rgba(250,204,21,.95)"/>
              <text x="60" y="70" text-anchor="middle" font-size="22" font-family="Inter, ui-sans-serif" font-weight="800"
                    fill="url(#gIce2)" style="letter-spacing:.5px">hallaym</text>
            </svg>
          </div>
          <div class="leading-tight">
            <div class="font-extrabold tracking-tight">HALLAYM <span class="u-anim">edu</span></div>
            <div class="text-xs muted">Parolni yangilash</div>
          </div>
        </a>

        <div class="flex items-center gap-2">
          <button id="themeToggle" class="glass rounded-xl px-3 py-2 text-sm font-extrabold muted btn-ghost glow-ring" title="Tungi/Kunduzgi">
            <i id="themeIcon" class="fa-solid fa-moon"></i>
            <span class="ml-2 hidden sm:inline" id="themeLabel">Tungi</span>
          </button>
          <a href="/login.html" class="glass rounded-xl px-4 py-2 text-sm font-bold btn-ghost glow-ring">
            <i class="fa-solid fa-right-to-bracket"></i>
            <span class="ml-2 hidden sm:inline">Kirish</span>
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-10">
    <div class="grid lg:grid-cols-2 gap-6 items-start">
      <section class="glass rounded-3xl p-8 g-border panel-pop">
        <div class="inline-flex items-center gap-2 glass rounded-full px-4 py-2 text-sm font-semibold muted">
          <i class="fa-solid fa-key"></i>
          <span>Token + yangi parol</span>
        </div>
        <h1 class="mt-4 text-3xl sm:text-4xl font-black tracking-tight">
          Parolni <span class="u-anim">tiklash</span>
        </h1>
        <p class="mt-3 muted text-base leading-relaxed safe-wrap">
          Token (15 daqiqa) va yangi parolni kiriting. Token <span class="font-extrabold">forgot-password</span> sahifasida olingan bo‘lishi kerak.
        </p>
      </section>

      <section class="glass rounded-3xl p-6 sm:p-7 g-border panel-pop">
        <div class="flex items-start justify-between gap-3 flex-wrap">
          <div>
            <div class="text-sm font-extrabold">Yangi parolni saqlash</div>
            <div class="text-xs muted2 mt-1">Token avtomatik to‘ldiriladi (bo‘lsa)</div>
          </div>
          <div id="msg" class="hidden text-sm font-bold px-3 py-2 rounded-xl glass"></div>
        </div>

        <form id="rpForm" class="mt-6 space-y-4">
          <div>
            <label class="text-xs font-extrabold muted">Token</label>
            <div class="mt-2 relative">
              <i class="fa-solid fa-ticket absolute left-4 top-1/2 -translate-y-1/2 muted2"></i>
              <input name="token" id="token" class="field w-full rounded-2xl px-11 py-3 text-sm" placeholder="Token" required />
            </div>
          </div>

          <div>
            <label class="text-xs font-extrabold muted">Yangi parol</label>
            <div class="mt-2 relative">
              <i class="fa-solid fa-lock absolute left-4 top-1/2 -translate-y-1/2 muted2"></i>
              <input name="newPassword" id="newPassword" type="password" class="field w-full rounded-2xl px-11 pr-12 py-3 text-sm" placeholder="Min 6" required />
              <button type="button" id="toggleNP" class="absolute right-3 top-1/2 -translate-y-1/2 glass rounded-xl px-3 py-2 btn-ghost glow-ring" title="Ko‘rsatish/Bekitish">
                <i id="npIcon" class="fa-solid fa-eye"></i>
              </button>
            </div>
          </div>

          <div>
            <label class="text-xs font-extrabold muted">Parolni takrorlang</label>
            <div class="mt-2 relative">
              <i class="fa-solid fa-lock-open absolute left-4 top-1/2 -translate-y-1/2 muted2"></i>
              <input name="confirm" id="confirm" type="password" class="field w-full rounded-2xl px-11 py-3 text-sm" placeholder="Takror" required />
            </div>
            <div id="hint" class="mt-2 text-xs muted2" style="min-height:16px;"></div>
          </div>

          <button id="btn" class="w-full btn-primary text-white rounded-2xl px-6 py-3 font-extrabold glow-ring">
            Saqlash <i class="fa-solid fa-floppy-disk ml-2"></i>
          </button>

          <div class="flex items-center justify-between text-xs muted2">
            <a class="font-extrabold underline" href="/forgot-password.html">Token olish</a>
            <a class="font-extrabold underline" href="/login.html">Login</a>
          </div>
        </form>
      </section>
    </div>
  </main>

  <script>
    (function(){
      const key='theme';
      const html=document.documentElement;
      const btn=document.getElementById('themeToggle');
      const icon=document.getElementById('themeIcon');
      const label=document.getElementById('themeLabel');

      function apply(mode){
        if(mode==='dark') html.classList.add('dark'); else html.classList.remove('dark');
        localStorage.setItem(key, mode);
        if(icon) icon.className = mode==='dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        if(label) label.textContent = mode==='dark' ? 'Kunduzgi' : 'Tungi';
      }

      const saved = localStorage.getItem(key);
      if(saved) apply(saved);
      else {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        apply(prefersDark ? 'dark' : 'light');
      }

      if(btn) btn.addEventListener('click', ()=> apply(html.classList.contains('dark') ? 'light' : 'dark'));
    })();
  </script>

  <script>
  (function(){
    const form = document.getElementById('rpForm');
    const btn = document.getElementById('btn');
    const msg = document.getElementById('msg');
    const hint = document.getElementById('hint');
    const tokenInput = document.getElementById('token');
    const np = document.getElementById('newPassword');
    const cp = document.getElementById('confirm');
    const toggle = document.getElementById('toggleNP');
    const npIcon = document.getElementById('npIcon');

    const saved = localStorage.getItem('resetToken');
    if(saved && !tokenInput.value) tokenInput.value = saved;

    function show(t, type){
      msg.textContent = t;
      msg.classList.remove('hidden');
      msg.style.background = type === 'error' ? 'var(--bad)' : 'var(--ok)';
      msg.style.border = '1px solid rgba(148,163,184,.20)';
      msg.style.color = type === 'error' ? 'rgba(220,38,38,.95)' : 'rgba(16,185,129,.95)';
      msg.style.backdropFilter = 'blur(16px)';
      clearTimeout(show._t);
      show._t = setTimeout(()=> msg.classList.add('hidden'), 6500);
    }

    function validate(){
      const a = String(np.value||'');
      const b = String(cp.value||'');
      if(!a && !b){ hint.textContent=''; return true; }
      if(a.length < 6){ hint.textContent='❌ Parol kamida 6 ta bo‘lsin'; return false; }
      if(a !== b){ hint.textContent='❌ Parollar mos emas'; return false; }
      hint.textContent = '✅ Parollar mos';
      return true;
    }
    np.addEventListener('input', validate);
    cp.addEventListener('input', validate);

    if(toggle){
      toggle.addEventListener('click', ()=>{
        const isPwd = np.type === 'password';
        np.type = isPwd ? 'text' : 'password';
        npIcon.className = isPwd ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye';
      });
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const token = String(tokenInput.value||'').trim();
      if(!token) return show('❌ Token kiriting', 'error');
      if(!validate()) return show('❌ Ma’lumotlarni tekshiring', 'error');

      btn.disabled = true;
      const old = btn.innerHTML;
      btn.innerHTML = 'Saqlanmoqda...';

      try{
        const r = await fetch('/api/auth/reset-password', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ token, newPassword: String(np.value||'') })
        });
        const j = await r.json().catch(()=>null);

        if(r.ok && j && (j.success === true || j.ok === true)){
          localStorage.removeItem('resetToken');
          show('✅ Parol yangilandi. Endi login qiling.', 'ok');
          setTimeout(()=>{ window.location.href='/login.html'; }, 900);
        } else {
          const err = (j && (j.error || j.message || j.msg)) || 'Xatolik';
          show('❌ ' + err, 'error');
        }
      } catch(err){
        show('❌ Tarmoq xatoligi', 'error');
      } finally {
        btn.disabled = false;
        btn.innerHTML = old;
      }
    });
  })();
  </script>
</body>
</html>
