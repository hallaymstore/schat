<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Guruh dars yozuvlari</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:#0b1220;color:#e5e7eb}
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);border-radius:18px}
    a{color:#93c5fd}
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-5xl mx-auto p-4">
    <div class="flex items-center justify-between gap-3 flex-wrap">
      <div>
        <h1 class="text-2xl font-extrabold">üìö Guruh dars yozuvlari</h1>
        <div class="text-sm text-white/70">Faqat shu guruh a‚Äôzolari ko‚Äòra oladi.</div>
      </div>
      <div class="flex gap-2">
        <a href="/groups.html" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10">‚Üê Guruhlar</a>
        <button id="refreshBtn" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10">Yangilash</button>
      </div>
    </div>

    <div class="mt-4 card p-4">
      <div class="text-sm text-white/70">Group ID:</div>
      <div class="font-mono text-xs break-all" id="gid">‚Äî</div>
      <div class="mt-2 text-xs text-white/60">Agar URL‚Äôda <code>?groupId=...</code> bo‚Äòlmasa, bu sahifa ishlamaydi.</div>
    </div>

    <div id="msg" class="mt-4 text-sm text-white/70"></div>
    <div id="list" class="mt-4 grid gap-3"></div>
  </div>

<script>
function getToken(){ return localStorage.getItem('token') || ''; }
function q(name){ return new URLSearchParams(location.search).get(name); }
function fmt(d){
  if(!d) return '‚Äî';
  const x=new Date(d);
  return x.toLocaleString([], {year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
}
function fmtDur(sec){
  sec = Number(sec||0);
  const m=Math.floor(sec/60), s=sec%60;
  return `${m}m ${String(s).padStart(2,'0')}s`;
}
async function load(){
  const groupId = q('groupId');
  document.getElementById('gid').textContent = groupId || '‚Äî';
  if(!groupId){ document.getElementById('msg').textContent = 'URLga groupId qo‚Äòshing.'; return; }

  document.getElementById('msg').textContent = 'Yuklanmoqda...';
  const res = await fetch(`/api/group-lessons?groupId=${encodeURIComponent(groupId)}`, {
    headers: { 'Authorization': `Bearer ${getToken()}` }
  });
  if(!res.ok){
    document.getElementById('msg').textContent = 'Xatolik: ' + res.status;
    return;
  }
  const data = await res.json();
  const list = document.getElementById('list');
  list.innerHTML = '';
  const lessons = data.lessons || [];
  document.getElementById('msg').textContent = lessons.length ? `${lessons.length} ta dars topildi` : 'Hali dars yozuvlari yo‚Äòq';

  lessons.forEach(l => {
    const div = document.createElement('div');
    div.className = 'card p-4';
    const rec = l.recordingUrl ? `<a class="underline" href="${l.recordingUrl}" target="_blank" rel="noreferrer">Ko‚Äòrish/Yuklab olish</a>` : `<span class="text-white/50">Yozuv yo‚Äòq</span>`;
    div.innerHTML = `
      <div class="flex items-start justify-between gap-3 flex-wrap">
        <div>
          <div class="text-lg font-bold">${(l.title||'Live dars')}</div>
          <div class="text-xs text-white/70 mt-1">
            Teacher: <span class="font-semibold">${l.host?.fullName || 'Teacher'}</span> ‚Ä¢ Boshlanish: ${fmt(l.startedAt)} ‚Ä¢ Tugash: ${fmt(l.endedAt)}
          </div>
          <div class="text-xs text-white/60 mt-1">Davomiylik: ${fmtDur(l.recordingDurationSec || 0)} ‚Ä¢ Rejim: ${l.mode || 'camera'} ‚Ä¢ Status: ${l.status}</div>
        </div>
        <div class="text-sm">${rec}</div>
      </div>
    `;
    list.appendChild(div);
  });
}

document.getElementById('refreshBtn').addEventListener('click', load);
load();
</script>
</body>
</html>
