<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Teacher Dashboard</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f6f7fb;color:#111}
    header{background:#111827;color:#fff;padding:18px 20px;display:flex;align-items:center;justify-content:space-between}
    header .left{display:flex;gap:12px;align-items:center}
    header .badge{background:#2563eb;padding:6px 10px;border-radius:999px;font-size:12px}
    .container{max-width:1100px;margin:18px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    .card h3{margin:0 0 10px 0;font-size:16px}
    .muted{color:#6b7280;font-size:13px;line-height:1.45}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .btn{display:inline-block;border:1px solid #d1d5db;background:#fff;color:#111827;padding:10px 12px;border-radius:10px;text-decoration:none;font-size:14px;cursor:pointer}
    .btn.primary{background:#2563eb;border-color:#2563eb;color:#fff}
    .btn.danger{background:#ef4444;border-color:#ef4444;color:#fff}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;font-size:12px;background:#f9fafb}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .kpi .box{flex:1;min-width:200px}
    .kpi .val{font-size:22px;font-weight:700;margin-top:6px}
    .col-12{grid-column:span 12}
    .col-8{grid-column:span 8}
    .col-4{grid-column:span 4}
    @media (max-width:900px){
      .col-8,.col-4{grid-column:span 12}
    }
    footer{padding:20px 16px;color:#6b7280;text-align:center}
    .err{background:#fff7ed;border:1px solid #fed7aa;color:#9a3412;padding:12px 14px;border-radius:12px;margin:14px 0;display:none}
  </style>
</head>
<body>
  <header>
    <div class="left">
      <div style="font-weight:700">QDTU LMS</div>
      <div class="badge">Teacher</div>
      <div id="facultyPill" class="pill" style="display:none"></div>
      <div id="groupPill" class="pill" style="display:none"></div>
    </div>
    <div class="row">
      <a class="btn" href="/profile.html">Profil</a>
      <button class="btn danger" id="logoutBtn">Chiqish</button>
    </div>
  </header>

  <div class="container">
    <div id="errBox" class="err"></div>

    <div class="grid">
      <div class="card col-12">
        <h3>Teacher boshqaruv paneli</h3>
        <div class="muted">
          Bu yerda siz kurslar yaratishingiz, dars materiallarini joylashingiz, testlar tuzishingiz va sertifikat jarayonini boshqarishingiz mumkin.
          (Keyingi bosqichda backend endpointlar va real CRUD funksiyalarni ulab chiqamiz.)
        </div>
      </div>

      <div class="card col-8">
        <h3>Hisob / Balans</h3>
        <div class="kpi">
          <div class="box">
            <div class="muted">Ism</div>
            <div class="val" id="nameVal">-</div>
          </div>
          <div class="box">
            <div class="muted">Coin (User balance)</div>
            <div class="val" id="coinsVal">-</div>
          </div>
          <div class="box">
            <div class="muted">Teacher balans (50%)</div>
            <div class="val" id="tBalanceVal">-</div>
          </div>
        </div>
        <div class="muted" style="margin-top:10px">
          Pullik kursga student qo‘shilganda: coin student balansidan yechiladi, 50% teacher balansiga qo‘shiladi, 50% admin uchun.
        </div>
      </div>

      <div class="card col-4">
        <h3>Tezkor amallar</h3>
        <div class="row" style="margin-top:6px">
          <a class="btn primary" href="/courses.html?mode=teacher">Kurslarim</a>
          <a class="btn" href="/tests.html?mode=teacher">Testlarim</a>
          <a class="btn" href="/certificate.html">Sertifikatlar</a>
        </div>
        <div class="muted" style="margin-top:10px">
          Agar siz student bo‘lsangiz bu sahifaga kira olmaysiz.
        </div>
      </div>

      <div class="card col-12">
        <h3>Kurs yaratish va dars joylash</h3>
        <div class="muted">
          Kurs ichidagi kontent turlari: YouTube video preview, matn, PDF preview. Kurs bepul yoki pullik bo‘ladi.
          Kursni faqat belgilangan fakultet/yo‘nalish guruhlariga (misol: MMT-520-25) ochiq qilasiz.
        </div>
        <div class="row" style="margin-top:12px">
          <a class="btn primary" href="/courses.html?mode=teacher&action=create">+ Yangi kurs</a>
          <a class="btn" href="/courses.html?mode=teacher">Kurslarni boshqarish</a>
        </div>
      </div>

      <div class="card col-12">
        <h3>Testlar</h3>
        <div class="muted">
          Testlar ketma-ket namoyish etiladi. Siz testni fakultet/yo‘nalish guruhlariga cheklab berishingiz mumkin.
        </div>
        <div class="row" style="margin-top:12px">
          <a class="btn primary" href="/tests.html?mode=teacher&action=create">+ Yangi test</a>
          <a class="btn" href="/tests.html?mode=teacher">Testlarni boshqarish</a>
        </div>
      </div>

      <div class="card col-12">
        <h3>Sertifikat</h3>
        <div class="muted">
          Kurs yakunida yoki test natijasiga ko‘ra sertifikat. Sertifikatda ism-familiya va guruh avtomatik kiritiladi.
          Canvas orqali dizayn qilinadi va PDF ko‘rinishida yuklab olinadi.
        </div>
        <div class="row" style="margin-top:12px">
          <a class="btn primary" href="/certificate.html">Sertifikat sahifasi</a>
        </div>
      </div>
    </div>
  </div>

  <footer>
    Qarshi Davlat Texnika Universiteti — LMS (Teacher Panel)
  </footer>

<script>
  const API_BASE = ""; // same origin
  function getToken(){
    return localStorage.getItem("token") || "";
  }
  function setErr(msg){
    const box = document.getElementById("errBox");
    box.textContent = msg;
    box.style.display = "block";
  }
  async function apiMe(){
    const token = getToken();
    if(!token){
      window.location.href = "/login.html";
      return;
    }
    const res = await fetch(API_BASE + "/api/me", {
      headers: { "Authorization": "Bearer " + token }
    });
    if(!res.ok){
      localStorage.removeItem("token");
      window.location.href = "/login.html";
      return;
    }
    const data = await res.json();

    const role = (data.role || "student").toLowerCase();
    if(role !== "teacher"){
      if(role === "admin"){
        window.location.href = "/admin-dashboard.html";
        return;
      }
      setErr("Siz teacher emassiz. Student paneliga yo'naltirilmoqda...");
      setTimeout(()=> window.location.href = "/student-dashboard.html", 800);
      return;
    }

    document.getElementById("nameVal").textContent = data.fullname || data.name || data.username || "-";
    document.getElementById("coinsVal").textContent = (data.coins ?? data.coin ?? 0);
    document.getElementById("tBalanceVal").textContent = (data.teacherBalance ?? 0);

    if(data.faculty){
      const f = document.getElementById("facultyPill");
      f.textContent = data.faculty;
      f.style.display = "inline-block";
    }
    if(data.group){
      const g = document.getElementById("groupPill");
      g.textContent = data.group;
      g.style.display = "inline-block";
    }
  }

  document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("token");
    window.location.href = "/login.html";
  });

  apiMe().catch(()=> setErr("Server bilan ulanishda xatolik. Keyinroq urinib ko'ring."));
</script>
</body>
</html>
